

# 第8章　事件处理

在第4章中简单讲解过v-on的基本用法。本章将继续深入学习Vue实现绑定事件的方法，使用v-on指令监听DOM事件来触发一些JavaScript代码。通过本章的学习，读者可以更加深入地掌握Vue中事件处理的技巧。

## 8.1　监听事件

事件其实就是在程序运行当中，可以调用方法改变对应的内容。下面先来看一个简单的示例。

```html

```

运行的结果为“期末考试总成绩是：360分”。

在上面示例中，如果想要改变考试成绩，就可以通过事件来完成。在JavaScript中可以使用的事件，在Vue.js中也都可以使用。使用事件时，需要v-on指令监听DOM事件。

下面看一个示例，它在上面示例的基础上添加两个按钮，当单击按钮时增加或减少考试成绩。

【例8.1】添加单击事件（源代码\ch08\8.1.html）。

```html

```

在浏览器中运行程序，多次单击“增加1分”按钮，期末考试总成绩会不断增加，结果如图8-1所示。

[插图]

图8-1　单击事件

## 8.2　事件处理方法

在上一节的示例中，是直接操作属性，但在实际的项目开发中，是不可能直接对属性进行操作的。例如，在上面示例中，如果想要单击一次按钮，期末考试成绩增加或减少10分呢？

许多事件处理逻辑会更为复杂，所以直接把JavaScript代码写在v-on指令中是不可行的。在Vue中，v-on还可以接收一个需要调用的方法名称，可以在方法中来完成复杂的逻辑。

下面示例在方法中实现单击按钮增加或减少10分的操作。

【例8.2】事件处理方法（源代码\ch08\8.2.html）。

```html

```

在浏览器中运行程序，单击“增加10分”按钮，期末考试总成绩就增加10分，结果如图8-2所示。

[插图]

图8-2　事件处理方法

注意，“v-on:”可以使用“@”代替，例如下面代码：

```html

```

“v-on:”和“@”作用是一样的，根据自己的习惯进行选择。

这样就把逻辑代码写到了方法中。相对于上面示例，还可以通过传入参数来实现，在调用方法时，传入想要增加或减少的数量，在Vue中定义一个change参数来接收。

【例8.3】事件处理方法的参数（源代码\ch08\8.3.html）。

```html

```

在浏览器中运行程序，单击“增加100分”按钮，期末考试总成绩就增加100分，结果如图8-3所示。

[插图]

图8-3　事件处理方法的参数

对于定义的方法，多个事件都可以调用。例如，在上面的示例中，再添加2个按钮，分别添加双击事件，并调用add()和reduce()方法。单击事件传入参数10，双击事件传入参数100，在Vue中使用change进行接收。

【例8.4】多个事件调用一个方法（源代码\ch08\8.4.html）。

```html

```

在浏览器中运行程序，单击或者双击按钮，期末考试总成绩会随着改变，效果如图8-4所示。

[插图]

图8-4　多个事件调用一个方法

> 

注意：在Vue事件中，可以使用事件名称add或reduce进行调用，也可以使用事件名加上“()”的形式，例如add()、reduce()。但是在具有参数时需要使用add()、reduce()的形式。在{{}}中调用方法时，必须使用add()、reduce()形式。

## 8.3　事件修饰符

对事件可以添加一些通用的限制。例如添加阻止事件冒泡，Vue对这种事件的限制提供了特定的写法，称之为修饰符，语法如下：

```html

```

在事件处理程序中调用event.preventDefault()（阻止默认行为）或event.stopPropagation()（阻止事件冒泡）是非常常见的需求。尽管可以在方法中轻松实现这一点，但更好的方式是使用纯粹的数据逻辑，而不是去处理DOM事件细节。

在Vue中，事件修饰符处理了许多DOM事件的细节，让我们不再需要花大量的时间去处理这些烦恼的事情，而能有更多的精力专注于程序的逻辑处理。

在Vue中事件修饰符主要有：

（1）stop：等同于JavaScript中的event.stopPropagation()，阻止事件冒泡。

（2）prevent：等同于JavaScript中的event.preventDefault()，阻止默认事件的发生。

（3）capture：与事件冒泡的方向相反，事件捕获由外到内。

（4）self：只会触发自己范围内的事件。

（5）once：只会触发一次。

（6）passive：执行默认行为。

下面分别来看一下每个修饰符的用法。

### 8.3.1　stop

stop修饰符用来阻止事件冒泡。在下面的示例中，创建了一个div元素，在其内部也创建一个div元素，并分别为它们添加单击事件。根据事件的冒泡机制可以得知，当单击内部的div元素之后，会扩散到父元素div，从而触发父元素的单击事件。

【例8.5】冒泡事件（源代码\ch08\8.5.html）。

```html

```

在浏览器中运行程序，单击内部inside元素，触发自身事件，效果如图8-5所示；根据事件的冒泡机制，也会触发外部的outside元素，效果如图8-6所示。

[插图]

图8-5　触发内部元素事件

[插图]

图8-6　触发外部元素事件如果不希望出现事件冒泡，则可以使用Vue内置的修饰符stop便捷地阻止事件冒泡的产生。因为是单击内部div元素后产生的事件冒泡，所以只需要在内部div元素的单击事件上加上stop修饰符即可。

【例8.6】使用stop修饰符阻止事件冒泡（源代码\ch08\8.6.html）。

修改上面HTML对应的代码：

```html

```

在浏览器中运行程序，单击内部的div后，将不再触发父元素单击事件，如图8-7所示。

[插图]

图8-7　只触发内部元素事件

### 8.3.2　capture

事件捕获模式与事件冒泡模式是一对相反的事件处理流程，当想要将页面元素的事件流改为事件捕获模式时，只需要在父级元素的事件上使用capture修饰符即可。若有多个该修饰符，则由外而内触发。

在下面示例中，创建了3个div元素，把它们分别嵌套，并添加单击事件。为外层的2个div元素添加capture修饰符。当单击内部的div元素时，将从外部向内触发含有capture修饰符的div元素的事件。

【例8.7】capture修饰符（源代码\ch08\8.7.html）。

```html

```

在浏览器中运行程序，单击内部的div元素，会先触发添加了capture修饰符的外层div元素，如图8-8所示；然后触发中间div元素，如图8-9所示；最后触发单击的内部元素，如图8-10所示。

[插图]

图8-8　触发外层div元素事件

[插图]

图8-9　触发中间div元素事件

[插图]

图8-10　触发内部div元素事件

### 8.3.3　self

self修饰符可以理解为跳过冒泡事件和捕获事件，只有直接作用在该元素上的事件才可以执行。self修饰符会监视事件是否是直接作用在元素上，若不是，则冒泡跳过该元素。

【例8.8】self修饰符（源代码\ch08\8.8.html）。

```html

```

在浏览器中运行程序，单击内部的div后，触发该元素的单击事件，效果如图8-11所示；由于中间div添加了self修饰符，并且直接单击该元素，所以就会跳过；内部div执行完毕，外层的div紧接着执行，效果如图8-12所示。



图8-11　触发内部div元素事件



图8-12　触发外层div元素事件

### 8.3.4　once

有时候需要只执行一次的操作，比如微信朋友圈点赞，这时便可以使用once修饰符来完成。

> 

提示：不像其他只能对原生的DOM事件起作用的修饰符，once修饰符还能被用到自定义的组件事件上。

【例8.9】once修饰符（源代码\ch08\8.9.html）。

```html

```

在浏览器中运行程序，单击“点赞0”按钮，count值从0变成1，之后，不管再单击多少次，count的值仍然是1，效果如图8-13所示。

[插图]

图8-13　once修饰符作用效果

### 8.3.5　prevent

prevent修饰符用于阻止默认行为，例如<a>标签，当单击标签时，默认行为会跳转到对应的链接，如果添加上prevent修饰符，将不会跳转到对应的链接。

而passive修饰符尤其能够提升移动端的性能。

> 

提示：不要把passive和prevent修饰符一起使用，因为prevent将会被忽略，同时浏览器可能会展示一个警告。passive修饰符会告诉浏览器不想阻止事件的默认行为。

【例8.10】prevent修饰符（源代码\ch08\8.10.html）。

```html

```

在浏览器中运行程序，单击“阻止跳转”，触发alert()事件弹出“阻止<a>标签的链接”，效果如图8-14所示；然后单击“确定”按钮，可发现页面将不再进行跳转。

[插图]

图8-14　prevent修饰符

### 8.3.6　passive

明明默认执行的行为，为什么还要使用passive修饰符呢？原因是浏览器只有等内核线程执行到事件监听器对应的JavaScript代码时，才能知道内部是否会调用preventDefault函数来阻止事件的默认行为，所以浏览器本身是没有办法对这种场景进行优化的。这种场景下，用户的手势事件无法快速产生，会导致页面无法快速执行滑动逻辑，从而让用户感觉到页面卡顿。

通俗地说就是每次事件产生时，浏览器都会去查询一下是否有preventDefault阻止该次事件的默认动作。加上passive修饰符就是为了告诉浏览器，不用查询了，没用preventDefault阻止默认行为。

passive修饰符一般用在滚动监听、@scoll和@touchmove中。因为滚动监听过程中，移动每个像素都会产生一次事件，每次都使用内核线程查询prevent会使滑动卡顿。通过passive修饰符将内核线程查询跳过，可以大大提升滑动的流畅度。

> 

注意：使用修饰符时，顺序很重要，相应的代码会以同样的顺序产生。因此，使用v-on:click.prevent.self会阻止所有的单击，而v-on:click.self.prevent只会阻止对元素自身的单击。

## 8.4　按键修饰符

在Vue中可以使用以下3种键盘事件：

* keydown：键盘按键按下时触发。
* keyup：键盘按键抬起时触发。
* keypress：键盘按键按下抬起间隔期间触发。

在日常的页面交互中，经常会遇到这种需求。例如，用户输入账号密码后按Enter键，以及一个多选筛选条件，通过单击多选框后自动加载符合选中条件的数据。在传统的前端开发中，碰到这种类似的需求时，往往需要知道JavaScript中需要监听的按键所对应的keyCode，然后通过判断keyCode得知用户按下了哪个按键，继而执行后续的操作。

> 

提示：keyCode返回keypress事件触发的键值的字符代码或keydown、keyup事件的键的代码。

下面来看一个示例，当触发键盘事件时，调用一个方法。在这个示例中，为两个input输入框绑定keyup事件，用键盘在输入框输入内容时触发，每次输入内容都会触发并调用name或password方法。

【例8.11】触发键盘事件（源代码\ch08\8.11.html）。

```html

```

在浏览器中运行，打开控制台，然后在输入框中输入姓名和密码。可以发现，每次输入时，都会调用对应的方法打印内容，如图8-15所示。

[插图]

图8-15　每次输入内容都会触发

Vue提供了一种便利的方式来实现监听按键事件。在监听键盘事件时，经常需要查找常见的按键所对应的keyCode，而Vue为最常用的按键提供了绝大多数常用的按键码的别名：[插图]对于上面示例，每次输入都会触发keyup事件，有时候不需要每次输入都会触发，例如发QQ消息，希望所有的内容都输入完成再发送。这时可以为keyup事件添加enter按键码，当Enter键抬起时，才会触发keyup事件。例如，修改上面的示例，在keyup事件后添加enter按键码。

【例8.12】添加enter按键码（源代码\ch08\8.12.html）。

```html

```

在浏览器中运行程序，在input输入框中输入姓名“洗衣机”，然后按下Enter键，弹起后触发keyup方法，打印“正在输入商品名称…”，效果如图8-16所示。

[插图]

图8-16　按Enter键并弹起时触发

## 8.5　系统修饰键

可以用如下修饰符来实现仅在按下相应按键时才触发鼠标或键盘事件的监听器。

```html

```



> 

提示：系统修饰键与常规按键不同，在和keyup事件一起使用时，事件触发时修饰键必须处于按下状态。换句话说，只有在按住Ctrl的情况下释放其他按键，才能触发keyup.ctrl。而单单释放Ctrl键也不会触发事件。

【例8.13】系统修饰键（源代码\ch08\8.13.html）。

```html

```

在浏览器中运行程序，在input中输入内容后，按Enter键是无法激活keyup事件的，首先需要按Shift，再按Enter键才可以触发，效果如图8-17所示。

[插图]

图8-17　系统修饰键

## 8.6　综合案例——处理用户注册信息

本案例主要在按钮、下拉列表、复选框上添加事件处理，从而实现注册用户时的信息处理。在选择“同意本站协议”复选框之前，“注册”按钮是不可用的。

【例8.14】处理用户注册信息（源代码\ch08\8.14.html）。

```html

```

在浏览器中运行程序，单击“单击按钮”，选择下拉列表项和选择复选框时，将触发不同的事件，如图8-18所示。

[插图]

图8-18　处理用户注册信息

## 8.7　疑难解惑

疑问1：为什么在HTML中监听事件？

读者可能注意到这种事件监听的方式违背了关注点分离（separation of concern）的传统理念。不必担心，因为所有的Vue.js事件处理方法和表达式都严格绑定在当前视图的ViewModel上，它不会导致任何维护上的困难。实际上，使用v-on有几个好处：

（1）通过HTML模板便能轻松定位在JavaScript代码里对应的方法。

（2）因为无须在JavaScript里手动绑定事件，ViewModel代码可以是非常纯粹的逻辑，和DOM完全解耦，更易于测试。

（3）当一个ViewModel被销毁时，所有的事件处理器都会自动被删除。无须担心如何清理它们。

疑问2：exact修饰符的用法？

exact修饰符允许控制由精确的系统修饰符组合触发的事件，示例代码如下：

[插图]















